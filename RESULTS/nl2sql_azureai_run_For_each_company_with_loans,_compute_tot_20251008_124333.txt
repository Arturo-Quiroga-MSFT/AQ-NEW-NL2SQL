========== RUN CONFIGURATION ==========
Timestamp: 2025-10-08 12:43:33
Implementation: Azure AI Foundry Agent Service
Model/Deployment: gpt-4.1
Project Endpoint: https://aq-ai-foundry-sweden-central.services.ai.azure.com/api/projects/firstProject
SQL Server: aqsqlserver001.database.windows.net
Database: CONTOSO-FI
Pipeline Options:
  - SQL execution: enabled
  - Explain-only mode: no

========== NATURAL LANGUAGE QUERY ==========
For each company with loans, compute total principal amount; show the top 20 companies by total principal.

========== INTENT & ENTITIES (AI AGENT) ==========
{
  "intent": "aggregate",
  "entity": ["company", "loans"],
  "metrics": ["total_principal_amount"],
  "filters": ["company has loans"],
  "group_by": ["company"],
  "aggregations": ["SUM(principal_amount)"],
  "order_by": ["total_principal_amount DESC"],
  "limit": 20
}

========== GENERATED SQL (RAW) ==========
SELECT
    c.CompanyId,
    c.CompanyName,
    SUM(l.PrincipalAmount) AS total_principal_amount
FROM
    dbo.Company c
INNER JOIN
    dbo.Loan l ON c.CompanyId = l.CompanyId
GROUP BY
    c.CompanyId,
    c.CompanyName
HAVING
    SUM(l.PrincipalAmount) > 0
ORDER BY
    total_principal_amount DESC
OFFSET 0 ROWS FETCH NEXT 20 ROWS ONLY;

========== SANITIZED SQL (FOR EXECUTION) ==========
SELECT
    c.CompanyId,
    c.CompanyName,
    SUM(l.PrincipalAmount) AS total_principal_amount
FROM
    dbo.Company c
INNER JOIN
    dbo.Loan l ON c.CompanyId = l.CompanyId
GROUP BY
    c.CompanyId,
    c.CompanyName
HAVING
    SUM(l.PrincipalAmount) > 0
ORDER BY
    total_principal_amount DESC
OFFSET 0 ROWS FETCH NEXT 20 ROWS ONLY;

========== SQL QUERY RESULTS (TABLE) ==========
CompanyId | CompanyName              | total_principal_amount
----------+--------------------------+-----------------------
2         | Blue Ridge Energy Corp   | 25000000.00           
14        | Toronto Health Devices   | 25000000.00           
1         | Acme Industrial Holdings | 24000000.00           
15        | Singapore Data Centers   | 22000000.00           
6         | Osaka Precision K.K.     | 22000000.00           
7         | Shanghai GreenChem Co    | 22000000.00           
8         | Mumbai InfraTech Ltd     | 22000000.00           
3         | Nordwind Logistics GmbH  | 18000000.00           
4         | Gaulois Pharma SA        | 18000000.00           
5         | Thyme Retail Group       | 18000000.00           
13        | Amsterdam FinTech BV     | 18000000.00           
9         | Cape Coast Minerals Ltd  | 12000000.00           
10        | Lagos Marine Services    | 12000000.00           
11        | Nairobi AgriFoods PLC    | 12000000.00           
12        | Alexandria Textiles Co   | 12000000.00           

========== TOKEN USAGE & COST ==========
Input tokens: 1503
Completion tokens: 181
Total tokens: 1684
Estimated cost (USD): 0.006167  [input=0.004163, output=0.002004; per-1k: in=0.00277, out=0.01107; source=file:azure_openai_pricing.json]

========== EXECUTION TIME ==========
Total elapsed time: 16.68s (16.682 seconds)

