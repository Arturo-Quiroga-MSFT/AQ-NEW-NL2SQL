erDiagram
  Company {
    bigint CompanyId PK
    nvarchar CompanyName
    char CountryCode FK
    nvarchar Industry
    varchar CreditRating
    smallint FoundedYear
    int EmployeeCount
  }

  Loan {
    bigint LoanId PK
    bigint CompanyId FK
    varchar LoanNumber
    date OriginationDate
    date MaturityDate
    decimal PrincipalAmount
    char CurrencyCode FK
    decimal InterestRatePct
    varchar InterestRateType
    varchar ReferenceRate
    smallint SpreadBps
    varchar AmortizationType
    tinyint PaymentFreqMonths
    nvarchar Purpose
    varchar Status
    varchar ReferenceRateCode FK
  }

  PaymentSchedule {
    bigint ScheduleId PK
    bigint LoanId FK
    int PaymentNumber
    date DueDate
    decimal StartingPrincipal
    decimal PrincipalDue
    decimal InterestDue
    decimal TotalDue
    char CurrencyCode FK
    varchar Status
    bit PaidFlag
    date PaidDate
    decimal EndingPrincipal
  }

  Collateral {
    bigint CollateralId PK
    bigint LoanId FK
    varchar CollateralType
    nvarchar Description
    nvarchar Jurisdiction
    decimal ValueAmount
    char CurrencyCode FK
    date ValuationDate
    varchar Status
  }

  Covenant {
    bigint CovenantId PK
    bigint LoanId FK
    varchar CovenantType
    varchar Operator
    decimal Threshold
    varchar Frequency
    date LastTestDate
    varchar Status
    nvarchar Notes
  }

  CovenantTestResult {
    bigint TestResultId PK
    bigint CovenantId FK
    bigint LoanId FK
    date TestDate
    varchar Status
    decimal ObservedValue
    nvarchar Notes
  }

  CovenantSchedule {
    bigint CovenantScheduleId PK
    bigint CovenantId FK
    date TestDueDate
    varchar RequiredOperator
    decimal RequiredThreshold
    int NotificationDays
  }

  PaymentEvent {
    bigint PaymentEventId PK
    bigint LoanId FK
    date EventDate
    varchar EventType
    decimal Amount
    char CurrencyCode FK
    int DaysDelinquent
    nvarchar Notes
  }

  CompanyAddress {
    bigint AddressId PK
    bigint CompanyId FK
    varchar AddressType
    nvarchar Line1
    nvarchar City
    nvarchar StateProvince
    nvarchar PostalCode
    char CountryCode FK
    decimal Latitude
    decimal Longitude
    date EffectiveDate
  }

  RiskMetricHistory {
    bigint RiskMetricHistoryId PK
    bigint CompanyId FK
    date AsOfDate
    varchar MetricName
    decimal MetricValue
    varchar Source
  }

  Country {
    char CountryCode PK
    nvarchar CountryName
    tinyint RegionId FK
    tinyint SubregionId FK
  }

  Region {
    tinyint RegionId PK
    nvarchar RegionName
  }

  Subregion {
    tinyint SubregionId PK
    nvarchar SubregionName
    tinyint RegionId FK
  }

  Currency {
    char CurrencyCode PK
    nvarchar CurrencyName
    nvarchar Symbol
  }

  ReferenceRate {
    varchar ReferenceRateCode PK
    nvarchar Description
    tinyint TenorMonths
    char CurrencyCode FK
  }

  FXRateDaily {
    date RateDate
    char FromCurrency FK
    char ToCurrency FK
    decimal Rate
  }

  %% Relationships (one-to-many shown as ||--o{)
  Company ||--o{ Loan : has
  Currency ||--o{ Loan : in
  ReferenceRate ||--o{ Loan : uses

  Loan ||--o{ PaymentSchedule : schedules
  Currency ||--o{ PaymentSchedule : in

  Loan ||--o{ Collateral : secures
  Currency ||--o{ Collateral : in

  Loan ||--o{ Covenant : has
  Covenant ||--o{ CovenantTestResult : results
  Loan ||--o{ CovenantTestResult : on
  Covenant ||--o{ CovenantSchedule : due_dates

  Loan ||--o{ PaymentEvent : events
  Currency ||--o{ PaymentEvent : in

  Company ||--o{ CompanyAddress : addresses
  Country ||--o{ Company : located_in
  Country ||--o{ CompanyAddress : addr_in
  Region ||--o{ Country : contains
  Subregion }o--|| Region : part_of
  Subregion ||--o{ Country : covers

  Company ||--o{ RiskMetricHistory : risk_metrics

  Currency ||--o{ FXRateDaily : rates_from
  Currency ||--o{ FXRateDaily : rates_to