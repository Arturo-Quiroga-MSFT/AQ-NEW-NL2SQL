# NL2SQL Chat â€” 2026-02-20, 10:03:58 a.m.

## Q: Average order value by store

```sql
WITH OrderTotals AS (
    SELECT
        o.StoreKey,
        o.OrderId,
        SUM(COALESCE(o.LineTotal, 0)) AS OrderValue
    FROM fact.FactOrders o
    GROUP BY
        o.StoreKey,
        o.OrderId
)
SELECT TOP 50
    s.StoreId,
    s.StoreName,
    s.StoreType,
    s.City,
    s.State,
    s.Country,
    s.Region,
    COUNT(*) AS OrderCount,
    CAST(AVG(CAST(ot.OrderValue AS decimal(19,4))) AS decimal(19,2)) AS AvgOrderValue,
    CAST(SUM(ot.OrderValue) AS decimal(19,2)) AS TotalRevenue
FROM OrderTotals ot
JOIN dim.DimStore s
    ON s.StoreKey = ot.StoreKey
GROUP BY
    s.StoreId,
    s.StoreName,
    s.StoreType,
    s.City,
    s.State,
    s.Country,
    s.Region
ORDER BY
    AvgOrderValue DESC,
    OrderCount DESC,
    s.StoreName ASC;
```

| StoreId | StoreName | StoreType | City | State | Country | Region | OrderCount | AvgOrderValue | TotalRevenue |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| STR-019 | New Brittneyton Flagship | Flagship | Laurenfurt | Colorado | United States | Southwest | 72 | 1030.24 | 74177.26 |
| STR-013 | New Jenniferfort Outlet | Outlet | West Heathermouth | Minnesota | United States | Midwest | 78 | 1010.81 | 78843 |
| STR-005 | Port Victoria Outlet | Outlet | Gregfort | Florida | United States | Southeast | 68 | 991.97 | 67454.02 |
| STR-012 | Port Johnstad Warehouse | Warehouse | West Jenniferbury | Michigan | United States | Midwest | 70 | 965.53 | 67586.87 |
| STR-003 | Georgeton Outlet | Outlet | Ramosstad | Connecticut | United States | Northeast | 76 | 946.01 | 71896.94 |
| STR-011 | West Lisa Flagship | Flagship | East Malikhaven | Ohio | United States | Midwest | 65 | 891.74 | 57963.18 |
| STR-014 | East Susan Outlet | Outlet | West Robert | Wisconsin | United States | Midwest | 76 | 884.16 | 67196.1 |
| STR-020 | Rasmussenfort Warehouse | Warehouse | Christopherstad | California | United States | West | 83 | 863.5 | 71670.61 |
| STR-016 | Ayersmouth Outlet | Outlet | West Ericmouth | Arizona | United States | Southwest | 70 | 849.32 | 59452.37 |
| STR-023 | Sethborough Flagship | Flagship | Clarkchester | Nevada | United States | West | 80 | 846.51 | 67721.14 |
| STR-006 | East Johnfort Warehouse | Warehouse | West Matthew | Georgia | United States | Southeast | 68 | 833.31 | 56665.31 |
| STR-017 | Larsonmouth Warehouse | Warehouse | West Jamesborough | New Mexico | United States | Southwest | 70 | 824.54 | 57717.49 |
| STR-004 | Stephanieshire Warehouse | Warehouse | Matthewsview | New Jersey | United States | Northeast | 66 | 818.02 | 53989.21 |
| STR-010 | Cynthiaton Outlet | Outlet | Edwinport | Illinois | United States | Midwest | 81 | 815.3 | 66039.67 |
| STR-022 | Averyfort Outlet | Outlet | Port Aaron | Oregon | United States | West | 71 | 812.35 | 57676.58 |
| STR-002 | Gordonbury Flagship | Flagship | Louiston | Pennsylvania | United States | Northeast | 74 | 779.97 | 57718.09 |
| STR-024 | New Jeffreyfurt Flagship | Flagship | Farleyhaven | Utah | United States | West | 74 | 768.61 | 56877.5 |
| STR-015 | Lake Elizabethside Warehouse | Warehouse | Patriciachester | Texas | United States | Southwest | 71 | 766.49 | 54421.06 |
| STR-001 | New Benjaminton Warehouse | Warehouse | Turnermouth | Massachusetts | United States | Northeast | 68 | 755.94 | 51403.62 |
| STR-021 | Lake Brittanymouth Outlet | Outlet | Blakeside | Washington | United States | West | 52 | 752.5 | 39129.86 |
| STR-008 | Lake Lori Outlet | Outlet | North John | Virginia | United States | Southeast | 62 | 740.26 | 45896.26 |
| STR-009 | Port David Flagship | Flagship | Port Anthonyland | Tennessee | United States | Southeast | 65 | 734.25 | 47726.51 |
| STR-018 | North Bradleyport Warehouse | Warehouse | Oconnorton | Oklahoma | United States | Southwest | 76 | 723.88 | 55014.62 |
| STR-ONLINE | RetailDW Online | Online | NULL | NULL | United States | NULL | 85 | 685.26 | 58247.07 |
| STR-007 | South Kyle Flagship | Flagship | East Kelly | North Carolina | United States | Southeast | 79 | 648.95 | 51267.23 |

*25 rows*

## Q: Average order value by store

```sql
WITH OrderTotals AS (
    SELECT
        o.StoreKey,
        o.OrderId,
        SUM(COALESCE(o.LineTotal, 0)) AS OrderValue
    FROM fact.FactOrders o
    GROUP BY
        o.StoreKey,
        o.OrderId
)
SELECT TOP 50
    s.StoreId,
    s.StoreName,
    s.StoreType,
    s.City,
    s.State,
    s.Country,
    s.Region,
    COUNT(*) AS OrderCount,
    CAST(AVG(CAST(ot.OrderValue AS decimal(19,4))) AS decimal(19,2)) AS AvgOrderValue,
    CAST(SUM(ot.OrderValue) AS decimal(19,2)) AS TotalRevenue
FROM OrderTotals ot
JOIN dim.DimStore s
    ON s.StoreKey = ot.StoreKey
GROUP BY
    s.StoreId,
    s.StoreName,
    s.StoreType,
    s.City,
    s.State,
    s.Country,
    s.Region
ORDER BY
    AvgOrderValue DESC,
    OrderCount DESC,
    s.StoreName ASC;
```

| StoreId | StoreName | StoreType | City | State | Country | Region | OrderCount | AvgOrderValue | TotalRevenue |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| STR-019 | New Brittneyton Flagship | Flagship | Laurenfurt | Colorado | United States | Southwest | 72 | 1030.24 | 74177.26 |
| STR-013 | New Jenniferfort Outlet | Outlet | West Heathermouth | Minnesota | United States | Midwest | 78 | 1010.81 | 78843 |
| STR-005 | Port Victoria Outlet | Outlet | Gregfort | Florida | United States | Southeast | 68 | 991.97 | 67454.02 |
| STR-012 | Port Johnstad Warehouse | Warehouse | West Jenniferbury | Michigan | United States | Midwest | 70 | 965.53 | 67586.87 |
| STR-003 | Georgeton Outlet | Outlet | Ramosstad | Connecticut | United States | Northeast | 76 | 946.01 | 71896.94 |
| STR-011 | West Lisa Flagship | Flagship | East Malikhaven | Ohio | United States | Midwest | 65 | 891.74 | 57963.18 |
| STR-014 | East Susan Outlet | Outlet | West Robert | Wisconsin | United States | Midwest | 76 | 884.16 | 67196.1 |
| STR-020 | Rasmussenfort Warehouse | Warehouse | Christopherstad | California | United States | West | 83 | 863.5 | 71670.61 |
| STR-016 | Ayersmouth Outlet | Outlet | West Ericmouth | Arizona | United States | Southwest | 70 | 849.32 | 59452.37 |
| STR-023 | Sethborough Flagship | Flagship | Clarkchester | Nevada | United States | West | 80 | 846.51 | 67721.14 |
| STR-006 | East Johnfort Warehouse | Warehouse | West Matthew | Georgia | United States | Southeast | 68 | 833.31 | 56665.31 |
| STR-017 | Larsonmouth Warehouse | Warehouse | West Jamesborough | New Mexico | United States | Southwest | 70 | 824.54 | 57717.49 |
| STR-004 | Stephanieshire Warehouse | Warehouse | Matthewsview | New Jersey | United States | Northeast | 66 | 818.02 | 53989.21 |
| STR-010 | Cynthiaton Outlet | Outlet | Edwinport | Illinois | United States | Midwest | 81 | 815.3 | 66039.67 |
| STR-022 | Averyfort Outlet | Outlet | Port Aaron | Oregon | United States | West | 71 | 812.35 | 57676.58 |
| STR-002 | Gordonbury Flagship | Flagship | Louiston | Pennsylvania | United States | Northeast | 74 | 779.97 | 57718.09 |
| STR-024 | New Jeffreyfurt Flagship | Flagship | Farleyhaven | Utah | United States | West | 74 | 768.61 | 56877.5 |
| STR-015 | Lake Elizabethside Warehouse | Warehouse | Patriciachester | Texas | United States | Southwest | 71 | 766.49 | 54421.06 |
| STR-001 | New Benjaminton Warehouse | Warehouse | Turnermouth | Massachusetts | United States | Northeast | 68 | 755.94 | 51403.62 |
| STR-021 | Lake Brittanymouth Outlet | Outlet | Blakeside | Washington | United States | West | 52 | 752.5 | 39129.86 |
| STR-008 | Lake Lori Outlet | Outlet | North John | Virginia | United States | Southeast | 62 | 740.26 | 45896.26 |
| STR-009 | Port David Flagship | Flagship | Port Anthonyland | Tennessee | United States | Southeast | 65 | 734.25 | 47726.51 |
| STR-018 | North Bradleyport Warehouse | Warehouse | Oconnorton | Oklahoma | United States | Southwest | 76 | 723.88 | 55014.62 |
| STR-ONLINE | RetailDW Online | Online | NULL | NULL | United States | NULL | 85 | 685.26 | 58247.07 |
| STR-007 | South Kyle Flagship | Flagship | East Kelly | North Carolina | United States | Southeast | 79 | 648.95 | 51267.23 |

*25 rows*
