# NL2SQL Chat â€” 2026-02-20, 9:10:13 a.m.

## Q: What are the top 5 products by revenue?

```sql
SELECT TOP 5 ProductId, ProductName, Category, Subcategory, Brand, TotalRevenue
FROM dbo.vw_ProductPerformance
ORDER BY TotalRevenue DESC
```

| ProductId | ProductName | Category | Subcategory | Brand | TotalRevenue |
| --- | --- | --- | --- | --- | --- |
| SKU-00467 | NorthPeak Outerwear AK39 | Clothing | Outerwear | NorthPeak | 24378.04 |
| SKU-00431 | PureEssence Fragrance QK17 | Beauty | Fragrance | PureEssence | 18197.49 |
| SKU-00037 | NorthPeak Jean WB45 | Clothing | Jeans | NorthPeak | 15800.08 |
| SKU-00410 | NestCraft Decor MV52 | Home & Kitchen | Decor | NestCraft | 15479.04 |
| SKU-00250 | NorthPeak Jean XU56 | Clothing | Jeans | NorthPeak | 15225.15 |

*5 rows*

## Q: Suggest indexes for FactOrders

# Index Recommendations for `fact.FactOrders`

## 1. Primary Key
- **OrderLineKey** is already the primary key (clustered index by default).

## 2. Foreign Key Columns
To optimize joins with dimension tables and common queries, add nonclustered indexes on these foreign keys:

```sql
-- CustomerKey (for customer-based queries)
CREATE NONCLUSTERED INDEX IX_FactOrders_CustomerKey
ON fact.FactOrders (CustomerKey);

-- ProductKey (for product-based queries)
CREATE NONCLUSTERED INDEX IX_FactOrders_ProductKey
ON fact.FactOrders (ProductKey);

-- OrderDateKey (for date-based queries)
CREATE NONCLUSTERED INDEX IX_FactOrders_OrderDateKey
ON fact.FactOrders (OrderDateKey);

-- StoreKey (for store-based queries)
CREATE NONCLUSTERED INDEX IX_FactOrders_StoreKey
ON fact.FactOrders (StoreKey);
```

## 3. Composite Indexes for Common Query Patterns

### a. OrderId + LineNumber
- For fast retrieval of all lines for an order (e.g., order detail lookups):

```sql
CREATE NONCLUSTERED INDEX IX_FactOrders_OrderId_LineNumber
ON fact.FactOrders (OrderId, LineNumber);
```

### b. ProductKey + OrderDateKey
- For product sales over time:

```sql
CREATE NONCLUSTERED INDEX IX_FactOrders_ProductKey_OrderDateKey
ON fact.FactOrders (ProductKey, OrderDateKey);
```

### c. CustomerKey + OrderDateKey
- For customer order history and time-based analysis:

```sql
CREATE NONCLUSTERED INDEX IX_FactOrders_CustomerKey_OrderDateKey
ON fact.FactOrders (CustomerKey, OrderDateKey);
```

## 4. Covering Indexes for Aggregations
If you frequently aggregate by product, customer, or date, consider including columns like `Quantity`, `LineTotal`, `LineProfit`:

```sql
CREATE NONCLUSTERED INDEX IX_FactOrders_ProductKey_OrderDateKey_Covering
ON fact.FactOrders (ProductKey, OrderDateKey)
INCLUDE (Quantity, LineTotal, LineProfit);
```

## 5. Other Foreign Keys
If you often filter or join on these, consider indexes:
- PromotionKey
- ShippingMethodKey
- PaymentMethodKey

Example:
```sql
CREATE NONCLUSTERED INDEX IX_FactOrders_PromotionKey
ON fact.FactOrders (PromotionKey);
```

---

## **Summary Table**

| Index Name                                 | Columns (Key)                | INCLUDE Columns           | Purpose                        |
|---------------------------------------------|------------------------------|---------------------------|--------------------------------|
| IX_FactOrders_CustomerKey                   | CustomerKey                  |                           | Customer queries/joins         |
| IX_FactOrders_ProductKey                    | ProductKey                   |                           | Product queries/joins          |
| IX_FactOrders_OrderDateKey                  | OrderDateKey                 |                           | Date queries/joins             |
| IX_FactOrders_StoreKey                      | StoreKey                     |                           | Store queries/joins            |
| IX_FactOrders_OrderId_LineNumber            | OrderId, LineNumber          |                           | Order detail lookups           |
| IX_FactOrders_ProductKey_OrderDateKey       | ProductKey, OrderDateKey     |                           | Product sales over time        |
| IX_FactOrders_CustomerKey_OrderDateKey      | CustomerKey, OrderDateKey    |                           | Customer order history         |
| IX_FactOrders_ProductKey_OrderDateKey_Covering | ProductKey, OrderDateKey  | Quantity, LineTotal, LineProfit | Fast aggregations         |

---

## **Best Practices**
- **Monitor index usage** with Azure SQL DMVs to avoid over-indexing.
- **Drop unused indexes** to save space and reduce write overhead.
- **Update statistics** regularly for optimal query plans.

---

**Note:** Tailor indexes to your most frequent query/reporting patterns for best results.
