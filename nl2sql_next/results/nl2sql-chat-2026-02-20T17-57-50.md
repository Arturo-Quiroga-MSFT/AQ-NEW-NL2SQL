# NL2SQL Chat — 2026-02-20, 12:57:50 p.m.

## Q: Describe the DimCustomer table

The **dim.DimCustomer** table is a dimension table in the RetailDW database, designed to store detailed information about customers. Here’s a comprehensive description:

### Table: dim.DimCustomer

| Column Name     | Data Type   | Description                                 | Key/Constraint      |
|-----------------|------------|----------------------------------------------|---------------------|
| CustomerKey     | int        | Surrogate key for the customer (unique)      | Primary Key         |
| CustomerId      | varchar    | Business/customer identifier (natural key)   |                     |
| FirstName       | nvarchar   | Customer's first name                        |                     |
| LastName        | nvarchar   | Customer's last name                         |                     |
| Email           | nvarchar   | Customer's email address                     |                     |
| Gender          | varchar    | Gender (e.g., Male, Female, Other)           |                     |
| BirthDate       | date       | Date of birth                                |                     |
| AgeGroup        | varchar    | Age group bucket (e.g., 25-34, 35-44)        |                     |
| City            | nvarchar   | City of residence                            |                     |
| State           | nvarchar   | State of residence                           |                     |
| Country         | nvarchar   | Country of residence                         |                     |
| PostalCode      | varchar    | Postal/ZIP code                              |                     |
| Region          | varchar    | Region (e.g., Midwest, West, Southeast)      |                     |
| MembershipTier  | varchar    | Loyalty/membership tier (e.g., Gold, Bronze) |                     |
| SignupDate      | date       | Date the customer signed up                  |                     |
| IsActive        | bit        | Whether the customer is currently active     |                     |
| CreatedDate     | datetime2  | Record creation timestamp                    |                     |

### Key Points

- **Primary Key:** `CustomerKey` (int, surrogate key)
- **Business Key:** `CustomerId` (varchar, natural key)
- **Demographics:** Name, gender, birth date, age group, address fields
- **Segmentation:** Region, membership tier, active status
- **Timestamps:** Signup date, record creation date
- **Usage:** Used as a foreign key in fact tables (e.g., orders, reviews, returns) to link transactions to customer details.

### Example Row

| CustomerKey | CustomerId   | FirstName | LastName | Email                        | Gender | BirthDate   | AgeGroup | ... |
|-------------|--------------|-----------|----------|------------------------------|--------|-------------|----------|-----|
| 1           | CUST-00001   | Mark      | Johnson  | mark.johnson@hotmail.com     | Male   | 1966-02-01  | 55-64    | ... |

### Relationships

- Referenced by:  
  - `fact.FactOrders.CustomerKey`
  - `fact.FactReturns.CustomerKey`
  - `fact.FactCustomerReview.CustomerKey`
  - `fact.FactWebTraffic.CustomerKey`

This table is central for customer analytics, segmentation, and joining with transactional data for reporting and insights.

## Q: what can you do as a DB assistant

As your Azure SQL Database assistant, I can help you with a wide range of database tasks, including but not limited to:

---

## 1. **Schema Exploration & Documentation**
- **List all tables and views** in your database, including row counts.
- **Describe table structures**: columns, data types, nullability, primary/foreign keys, and relationships.
- **Show relationships** between tables (e.g., foreign key mappings).

---

## 2. **Data Exploration & Analysis**
- **Preview sample data** from any table or view.
- **Run custom SELECT queries** to extract, filter, aggregate, or join data.
- **Summarize data** (counts, averages, trends, etc.).
- **Analyze data quality** (e.g., NULLs, duplicates, outliers).

---

## 3. **Query Generation & Optimization**
- **Generate T-SQL queries** for reporting, analytics, or troubleshooting.
- **Suggest query optimizations** (indexes, query rewrites, etc.).
- **Explain query logic** and help you understand complex SQL.

---

## 4. **Data Modification** (with your approval)
- **Insert, update, or delete data** in tables (requires your explicit approval for each operation).
- **Bulk data operations** (e.g., mass updates, cleanups).

---

## 5. **Best Practices & Troubleshooting**
- **Recommend schema improvements** (normalization, indexing, constraints).
- **Help troubleshoot errors** or performance issues.
- **Advise on security, backups, and compliance** (at the SQL level).

---

## 6. **Automation & Scripting**
- **Generate scripts** for recurring tasks (e.g., scheduled reports, data refreshes).
- **Help with ETL logic** (Extract, Transform, Load).

---

## 7. **Custom Requests**
- **Answer ad-hoc questions** about your data, schema, or SQL.
- **Assist with BI/reporting needs** (Power BI, Excel, etc.).

---

### **How I Work**
- I use live database tools to inspect your schema and data.
- I always use two-part names (e.g., dim.DimCustomer).
- For data changes, I send the SQL for your approval before execution.
- I never make schema changes (CREATE/DROP/ALTER) unless specifically enabled.

---

**Just ask your question or describe your task!**  
Examples:
- “Show me the top 10 products by revenue.”
- “List all customers in California.”
- “How many orders were placed in 2023?”
- “Update the email for customer CUST-00001.”
- “What are the foreign keys on fact.FactOrders?”

Let me know what you’d like to do!

## Q: what can you do as a DB assistant

As an Azure SQL Database assistant/DBA for **RetailDW**, I can help with:

## 1) Schema exploration (live)
- List tables/views with row counts (e.g., `fact.FactOrders`, `dbo.vw_MonthlySales`)
- Describe tables: columns, data types, NULLability, PK/FK relationships
- Explain how facts/dimensions relate (star schema joins)

## 2) Query writing (T‑SQL for Azure SQL)
- Write a **single SELECT** (CTEs OK) using **two-part names** (`schema.Object`)
- Build analytics queries: sales by month/region/category, CLV, returns rate, inventory snapshots, web traffic conversion, etc.
- Handle NULLs correctly (`COALESCE/ISNULL`) and date logic via `dim.DimDate`

## 3) Troubleshooting & optimization guidance
- Identify why a query is slow (join patterns, filters, cardinality)
- Recommend specific indexes (keys, included columns) and rewrites (sargability, aggregation strategy)

## 4) Data validation / sanity checks
- Find duplicates, missing dimension keys, orphaned fact rows
- Reconcile totals between views and underlying fact tables
- Check data distributions (e.g., returns by reason, revenue by tier)

## 5) Safe data changes (only if you request)
- Execute `INSERT/UPDATE/DELETE` via a write tool that requires approval in the UI before it runs.

If you tell me the business question (e.g., “top products by profit in 2024” or “monthly conversion rate by device”), I’ll generate the exact SELECT for this schema.

## Q: what can you do as a DB assistant

As your Azure SQL Database assistant/DBA for **RetailDW**, I can help with:

## 1) Schema exploration & documentation
- List tables/views and approximate row counts
- Describe tables (columns, data types, nullability, defaults)
- Explain **PK/FK relationships** and how to join facts ↔ dimensions
- Provide quick “what’s in this table?” summaries and data dictionaries

## 2) Query writing (T‑SQL for Azure SQL)
- Generate **single-SELECT** queries (CTEs OK) using **two-part names** (e.g., `fact.FactOrders`)
- Build star-schema analytics queries (sales, profit, returns, inventory, traffic)
- Use the provided convenience views (e.g., `dbo.vw_MonthlySales`, `dbo.vw_ProductPerformance`)

## 3) Data validation & troubleshooting (read-only analysis)
- Sanity checks (row counts by date, null rates, orphan keys, duplicates)
- Reconcile metrics (revenue vs profit vs cost, returns/refunds)
- Identify data quality issues (missing dimension members, unexpected outliers)

## 4) Performance & tuning guidance
- Recommend indexes (including composite indexes) based on your query patterns
- Help interpret execution-plan issues conceptually (key lookups, scans, joins)
- Suggest partitioning strategies (where appropriate) and stats maintenance tips

## 5) Safe data changes (when you explicitly ask)
- Execute `INSERT` / `UPDATE` / `DELETE` via the system’s approval flow (you approve/reject)

If you tell me your goal (e.g., “top products by profit last quarter”, “return rate by category”, “customer LTV by region”), I’ll produce the exact T‑SQL.

## Q: customer LTV by region

```sql
WITH RegionAgg AS (
    SELECT
        COALESCE(Region, 'Unknown') AS Region,
        COUNT(*) AS CustomerCount,
        SUM(COALESCE(TotalOrders, 0)) AS TotalOrders,
        SUM(COALESCE(LifetimeRevenue, 0)) AS TotalLifetimeRevenue,
        SUM(COALESCE(LifetimeProfit, 0)) AS TotalLifetimeProfit,
        AVG(COALESCE(LifetimeRevenue, 0.0)) AS AvgCustomerLifetimeRevenue,
        AVG(COALESCE(LifetimeProfit, 0.0)) AS AvgCustomerLifetimeProfit,
        AVG(COALESCE(AvgOrderValue, 0.0)) AS AvgOrderValue
    FROM dbo.vw_CustomerLifetimeValue
    GROUP BY COALESCE(Region, 'Unknown')
)
SELECT TOP 50
    Region,
    CustomerCount,
    TotalOrders,
    TotalLifetimeRevenue,
    TotalLifetimeProfit,
    AvgCustomerLifetimeRevenue,
    AvgCustomerLifetimeProfit,
    AvgOrderValue
FROM RegionAgg
ORDER BY TotalLifetimeRevenue DESC, Region ASC;
```

| Region | CustomerCount | TotalOrders | TotalLifetimeRevenue | TotalLifetimeProfit | AvgCustomerLifetimeRevenue | AvgCustomerLifetimeProfit | AvgOrderValue |
| --- | --- | --- | --- | --- | --- | --- | --- |
| West | 276 | 350 | 292110.57 | 143158.77 | 1058.37163 | 518.691195 | 430.277148 |
| Southwest | 273 | 340 | 288292.79 | 138554.14 | 1056.017545 | 507.524322 | 425.962449 |
| Midwest | 262 | 339 | 262321.85 | 124746.14 | 1001.228435 | 476.130305 | 393.5816 |
| Southeast | 233 | 311 | 260629.33 | 122145.76 | 1118.580815 | 524.230729 | 384.748786 |
| Northeast | 239 | 302 | 244514.4 | 115604.05 | 1023.072803 | 483.698953 | 409.91797 |

*5 rows*

## Q: top products by profit last quarter”

```sql
WITH QuarterBounds AS (
    SELECT
        CAST(DATEADD(QUARTER, DATEDIFF(QUARTER, 0, GETDATE()) - 1, 0) AS date) AS StartDate,
        CAST(DATEADD(QUARTER, DATEDIFF(QUARTER, 0, GETDATE()), 0) AS date) AS EndDate
)
SELECT TOP 50
    p.ProductId,
    p.ProductName,
    p.Category,
    p.Subcategory,
    p.Brand,
    SUM(COALESCE(o.LineProfit, 0)) AS TotalProfit,
    SUM(COALESCE(o.LineTotal, 0)) AS TotalRevenue,
    SUM(COALESCE(o.Quantity, 0)) AS TotalUnitsSold,
    COUNT(DISTINCT o.OrderId) AS OrderCount
FROM fact.FactOrders o
JOIN dim.DimProduct p
    ON o.ProductKey = p.ProductKey
JOIN dim.DimDate d
    ON o.OrderDateKey = d.DateKey
CROSS JOIN QuarterBounds qb
WHERE d.Date >= qb.StartDate
  AND d.Date < qb.EndDate
GROUP BY
    p.ProductId,
    p.ProductName,
    p.Category,
    p.Subcategory,
    p.Brand
ORDER BY
    TotalProfit DESC,
    p.ProductId ASC;
```

| ProductId | ProductName | Category | Subcategory | Brand | TotalProfit | TotalRevenue | TotalUnitsSold | OrderCount |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| SKU-00209 | PureSpace Cookware RN53 | Home & Kitchen | Cookware | PureSpace | 1159.12 | 1828.44 | 4 | 1 |
| SKU-00381 | ClearView Camera HI73 | Electronics | Cameras | ClearView | 1140.59 | 1897.6 | 4 | 2 |
| SKU-00052 | FlexForm Water Sport PG04 | Sports & Outdoors | Water Sports | FlexForm | 918.12 | 2108.43 | 5 | 2 |
| SKU-00343 | HavenHome Cookware OT70 | Home & Kitchen | Cookware | HavenHome | 872.56 | 1457.28 | 4 | 1 |
| SKU-00207 | WaveRider Cycling CU26 | Sports & Outdoors | Cycling | WaveRider | 843.27 | 1847.91 | 6 | 4 |
| SKU-00180 | PureEssence Fragrance VH03 | Beauty | Fragrance | PureEssence | 835.33 | 1369.43 | 5 | 2 |
| SKU-00427 | Scholar House Children IZ92 | Books | Children | Scholar House | 804.53 | 1599.19 | 4 | 1 |
| SKU-00281 | ClassicStitch Womens Dresse HD60 | Clothing | Womens Dresses | ClassicStitch | 732.71 | 1149.6 | 4 | 1 |
| SKU-00289 | BrainSpark Puzzle ZX59 | Toys & Games | Puzzles | BrainSpark | 686.24 | 1327.11 | 3 | 1 |
| SKU-00118 | Kinetic Cycling ZN59 | Sports & Outdoors | Cycling | Kinetic | 637.02 | 1446.78 | 3 | 1 |
| SKU-00214 | FitFlex Accessorie DH82 | Clothing | Accessories | FitFlex | 630.87 | 1012.96 | 3 | 2 |
| SKU-00420 | ComfortPlus Small Appliance VZ25 | Home & Kitchen | Small Appliances | ComfortPlus | 627.09 | 1215.42 | 6 | 2 |
| SKU-00312 | HavenHome Decor LF11 | Home & Kitchen | Decor | HavenHome | 625.37 | 960.69 | 3 | 1 |
| SKU-00129 | SummitGear Running VG09 | Sports & Outdoors | Running | SummitGear | 543.9 | 1276.95 | 3 | 1 |
| SKU-00050 | PureSpace Cookware JK27 | Home & Kitchen | Cookware | PureSpace | 543.72 | 833.16 | 2 | 1 |
| SKU-00232 | VelvetSkin Haircare TH92 | Beauty | Haircare | VelvetSkin | 542.44 | 818.08 | 4 | 1 |
| SKU-00379 | SoundWave Smartphone IR04 | Electronics | Smartphones | SoundWave | 532.46 | 894.22 | 2 | 1 |
| SKU-00318 | ChefLine Decor QW18 | Home & Kitchen | Decor | ChefLine | 529.65 | 809.88 | 4 | 1 |
| SKU-00286 | Rainbow Reads Children FI90 | Books | Children | Rainbow Reads | 504.76 | 1294.62 | 3 | 1 |
| SKU-00123 | Scholar House Textbook OT19 | Books | Textbooks | Scholar House | 459.44 | 1315 | 3 | 1 |
| SKU-00186 | AuraBlend Fragrance LW83 | Beauty | Fragrance | AuraBlend | 448.24 | 761.7 | 2 | 2 |
| SKU-00128 | EcoWear Womens Dresse DV59 | Clothing | Womens Dresses | EcoWear | 437.86 | 1009.32 | 3 | 1 |
| SKU-00301 | UrbanThread Womens Dresse CX96 | Clothing | Womens Dresses | UrbanThread | 426.68 | 712.78 | 2 | 1 |
| SKU-00355 | SummitGear Camping OF39 | Sports & Outdoors | Camping | SummitGear | 425.79 | 709.13 | 5 | 2 |
| SKU-00115 | PureEssence Haircare IF65 | Beauty | Haircare | PureEssence | 423.01 | 715.1 | 2 | 1 |
| SKU-00294 | PureSpace Cookware II72 | Home & Kitchen | Cookware | PureSpace | 420.08 | 845.42 | 2 | 2 |
| SKU-00217 | NestCraft Furniture IH42 | Home & Kitchen | Furniture | NestCraft | 418.64 | 707.76 | 4 | 1 |
| SKU-00185 | GlowLab Skincare OT05 | Beauty | Skincare | GlowLab | 365.45 | 652.8 | 3 | 1 |
| SKU-00149 | FunWorld Puzzle OZ21 | Toys & Games | Puzzles | FunWorld | 365.43 | 773.84 | 4 | 1 |
| SKU-00218 | FreshHarvest Organic TX83 | Grocery | Organic | FreshHarvest | 361.47 | 744.12 | 2 | 1 |
| SKU-00004 | SnackBox Beverage SA42 | Grocery | Beverages | SnackBox | 360.3 | 596.35 | 3 | 2 |
| SKU-00429 | BrainSpark Action Figure ZK14 | Toys & Games | Action Figures | BrainSpark | 350.9 | 677.05 | 2 | 1 |
| SKU-00263 | VoltEdge Headphone GV57 | Electronics | Headphones | VoltEdge | 340.48 | 598.5 | 2 | 1 |
| SKU-00325 | EcoWear Activewear BE22 | Clothing | Activewear | EcoWear | 338.53 | 800.89 | 2 | 1 |
| SKU-00035 | FitFlex Accessorie XN43 | Clothing | Accessories | FitFlex | 326.95 | 607.85 | 5 | 2 |
| SKU-00440 | FunWorld Outdoor Toy RZ10 | Toys & Games | Outdoor Toys | FunWorld | 300.87 | 734.82 | 3 | 2 |
| SKU-00371 | PureSpace Cookware QH68 | Home & Kitchen | Cookware | PureSpace | 299.09 | 862.61 | 3 | 2 |
| SKU-00099 | PixelCore TV BS27 | Electronics | TVs | PixelCore | 298.87 | 911.82 | 3 | 2 |
| SKU-00161 | UrbanThread Womens Dresse TZ52 | Clothing | Womens Dresses | UrbanThread | 297.23 | 495.1 | 1 | 1 |
| SKU-00459 | Scholar House Non-Fiction AR97 | Books | Non-Fiction | Scholar House | 287.86 | 448.67 | 1 | 1 |
| SKU-00191 | Rainbow Reads Fiction YS65 | Books | Fiction | Rainbow Reads | 284.27 | 474.28 | 1 | 1 |
| SKU-00150 | GlowLab Makeup PY62 | Beauty | Makeup | GlowLab | 283.92 | 518.6 | 2 | 2 |
| SKU-00145 | Kinetic Running SN66 | Sports & Outdoors | Running | Kinetic | 276.52 | 500.53 | 3 | 2 |
| SKU-00500 | GlowLab Haircare MK32 | Beauty | Haircare | GlowLab | 270.9 | 457.01 | 1 | 1 |
| SKU-00336 | GreenPantry Organic DQ68 | Grocery | Organic | GreenPantry | 262.28 | 721.84 | 3 | 1 |
| SKU-00096 | HavenHome Bedding XB99 | Home & Kitchen | Bedding | HavenHome | 259.57 | 423.85 | 1 | 1 |
| SKU-00419 | StarToy Outdoor Toy AW37 | Toys & Games | Outdoor Toys | StarToy | 250.65 | 485.27 | 2 | 2 |
| SKU-00055 | PureSpace Bedding MV20 | Home & Kitchen | Bedding | PureSpace | 249.14 | 748.54 | 3 | 1 |
| SKU-00162 | FlexForm Camping TJ80 | Sports & Outdoors | Camping | FlexForm | 245.97 | 411.03 | 3 | 1 |
| SKU-00033 | StarToy Video Game YF01 | Toys & Games | Video Games | StarToy | 241.12 | 393.85 | 1 | 1 |

*50 rows*

## Q: show me some "tough" questions that would require a solid SQL query

**Error:** -- CANNOT_ANSWER: The request is to generate example "tough" questions (text), not to retrieve data; it cannot be answered with a single T-SQL SELECT query against the provided schema.

## Q: show me sample questions that require to query tables and do joins

**Error:** -- CANNOT_ANSWER: The user is asking for example questions (natural language prompts), not for data that can be retrieved via a SELECT query from the provided schema.

## Q: show me sample questions that require to query tables and do joins

**Error:** -- CANNOT_ANSWER: This request is for sample questions, not a SQL query.

## Q: show me sample questions

Absolutely! Here are some **sample questions** you can ask me as your Azure SQL Database assistant for the RetailDW database. These cover a range of analytics, reporting, and data exploration scenarios:

---

## Customer Analytics
- What is the average customer lifetime value (LTV) by membership tier?
- List the top 10 customers by total revenue.
- How many active customers are there in each region?
- Show customer churn rate by month.

## Sales & Revenue
- What were the total sales and profit by month for the last year?
- Which products generated the most revenue last quarter?
- Show sales trends by product category.
- What is the average order value by store type?

## Product Performance
- List the top 5 products by number of returns.
- Which brands have the highest average product rating?
- Show product performance by category and subcategory.

## Returns & Reviews
- What are the most common return reasons?
- Show the return rate by product category.
- List products with the lowest average review sentiment.

## Inventory & Operations
- Which stores have the lowest inventory for top-selling products?
- Show inventory value by store and product category.
- List products below their reorder point.

## Web & Marketing Analytics
- What is the conversion rate by traffic source?
- Show web traffic trends by device type.
- List the top landing pages by session count.

## General Data Exploration
- Describe the structure of the FactOrders table.
- List all available views and their row counts.
- Show a sample of 10 rows from the DimProduct table.

---

**You can also ask for:**
- Custom SQL queries for your business questions
- Data model explanations and relationship diagrams
- Suggestions for performance tuning or indexing

Let me know what you’d like to explore!

## Q: Which stores have the lowest inventory for top-selling products?

```sql
WITH TopProducts AS (
    SELECT TOP 10 ProductKey
    FROM fact.FactOrders
    GROUP BY ProductKey
    ORDER BY SUM(COALESCE(Quantity,0)) DESC
),
InventoryStatus AS (
    SELECT
        i.ProductKey,
        i.StoreKey,
        SUM(COALESCE(i.QuantityOnHand,0)) AS TotalQuantityOnHand
    FROM fact.FactInventory i
    WHERE i.ProductKey IN (SELECT ProductKey FROM TopProducts)
    GROUP BY i.ProductKey, i.StoreKey
)
SELECT TOP 50
    p.ProductId,
    p.ProductName,
    s.StoreId,
    s.StoreName,
    InventoryStatus.TotalQuantityOnHand
FROM InventoryStatus
JOIN dim.DimProduct p ON InventoryStatus.ProductKey = p.ProductKey
JOIN dim.DimStore s ON InventoryStatus.StoreKey = s.StoreKey
ORDER BY InventoryStatus.TotalQuantityOnHand ASC, p.ProductId, s.StoreId
```

| ProductId | ProductName | StoreId | StoreName | TotalQuantityOnHand |
| --- | --- | --- | --- | --- |
| SKU-00069 | FreshHarvest Organic MC95 | STR-004 | Stephanieshire Warehouse | 0 |
| SKU-00428 | PageTurn Press Textbook KH87 | STR-006 | East Johnfort Warehouse | 5 |
| SKU-00458 | SoundWave Camera OT23 | STR-008 | Lake Lori Outlet | 5 |
| SKU-00418 | GlowLab Haircare HZ42 | STR-020 | Rasmussenfort Warehouse | 8 |
| SKU-00418 | GlowLab Haircare HZ42 | STR-017 | Larsonmouth Warehouse | 9 |
| SKU-00292 | SnackBox Beverage RY35 | STR-014 | East Susan Outlet | 14 |
| SKU-00318 | ChefLine Decor QW18 | STR-006 | East Johnfort Warehouse | 21 |
| SKU-00207 | WaveRider Cycling CU26 | STR-005 | Port Victoria Outlet | 24 |
| SKU-00458 | SoundWave Camera OT23 | STR-ONLINE | RetailDW Online | 26 |
| SKU-00458 | SoundWave Camera OT23 | STR-011 | West Lisa Flagship | 32 |
| SKU-00418 | GlowLab Haircare HZ42 | STR-007 | South Kyle Flagship | 33 |
| SKU-00207 | WaveRider Cycling CU26 | STR-004 | Stephanieshire Warehouse | 35 |
| SKU-00292 | SnackBox Beverage RY35 | STR-013 | New Jenniferfort Outlet | 35 |
| SKU-00492 | Insight Books Children ZO29 | STR-005 | Port Victoria Outlet | 41 |
| SKU-00492 | Insight Books Children ZO29 | STR-007 | South Kyle Flagship | 42 |
| SKU-00292 | SnackBox Beverage RY35 | STR-007 | South Kyle Flagship | 47 |
| SKU-00428 | PageTurn Press Textbook KH87 | STR-010 | Cynthiaton Outlet | 47 |
| SKU-00144 | NorthPeak Outerwear AG10 | STR-017 | Larsonmouth Warehouse | 50 |
| SKU-00318 | ChefLine Decor QW18 | STR-013 | New Jenniferfort Outlet | 53 |
| SKU-00069 | FreshHarvest Organic MC95 | STR-016 | Ayersmouth Outlet | 56 |
| SKU-00069 | FreshHarvest Organic MC95 | STR-007 | South Kyle Flagship | 57 |
| SKU-00428 | PageTurn Press Textbook KH87 | STR-011 | West Lisa Flagship | 58 |
| SKU-00207 | WaveRider Cycling CU26 | STR-014 | East Susan Outlet | 63 |
| SKU-00061 | PureEssence Fragrance OH07 | STR-024 | New Jeffreyfurt Flagship | 67 |
| SKU-00292 | SnackBox Beverage RY35 | STR-009 | Port David Flagship | 71 |
| SKU-00458 | SoundWave Camera OT23 | STR-016 | Ayersmouth Outlet | 71 |
| SKU-00418 | GlowLab Haircare HZ42 | STR-ONLINE | RetailDW Online | 72 |
| SKU-00492 | Insight Books Children ZO29 | STR-003 | Georgeton Outlet | 72 |
| SKU-00292 | SnackBox Beverage RY35 | STR-006 | East Johnfort Warehouse | 73 |
| SKU-00069 | FreshHarvest Organic MC95 | STR-018 | North Bradleyport Warehouse | 75 |
| SKU-00144 | NorthPeak Outerwear AG10 | STR-024 | New Jeffreyfurt Flagship | 75 |
| SKU-00061 | PureEssence Fragrance OH07 | STR-022 | Averyfort Outlet | 76 |
| SKU-00207 | WaveRider Cycling CU26 | STR-009 | Port David Flagship | 81 |
| SKU-00492 | Insight Books Children ZO29 | STR-013 | New Jenniferfort Outlet | 85 |
| SKU-00418 | GlowLab Haircare HZ42 | STR-015 | Lake Elizabethside Warehouse | 87 |
| SKU-00418 | GlowLab Haircare HZ42 | STR-018 | North Bradleyport Warehouse | 89 |
| SKU-00069 | FreshHarvest Organic MC95 | STR-ONLINE | RetailDW Online | 90 |
| SKU-00428 | PageTurn Press Textbook KH87 | STR-008 | Lake Lori Outlet | 94 |
| SKU-00428 | PageTurn Press Textbook KH87 | STR-021 | Lake Brittanymouth Outlet | 94 |
| SKU-00418 | GlowLab Haircare HZ42 | STR-016 | Ayersmouth Outlet | 95 |
| SKU-00458 | SoundWave Camera OT23 | STR-020 | Rasmussenfort Warehouse | 95 |
| SKU-00428 | PageTurn Press Textbook KH87 | STR-014 | East Susan Outlet | 96 |
| SKU-00144 | NorthPeak Outerwear AG10 | STR-004 | Stephanieshire Warehouse | 99 |
| SKU-00144 | NorthPeak Outerwear AG10 | STR-006 | East Johnfort Warehouse | 104 |
| SKU-00428 | PageTurn Press Textbook KH87 | STR-022 | Averyfort Outlet | 104 |
| SKU-00458 | SoundWave Camera OT23 | STR-009 | Port David Flagship | 107 |
| SKU-00061 | PureEssence Fragrance OH07 | STR-016 | Ayersmouth Outlet | 109 |
| SKU-00458 | SoundWave Camera OT23 | STR-005 | Port Victoria Outlet | 110 |
| SKU-00458 | SoundWave Camera OT23 | STR-014 | East Susan Outlet | 111 |
| SKU-00144 | NorthPeak Outerwear AG10 | STR-021 | Lake Brittanymouth Outlet | 113 |

*50 rows*

## Q: Which stores have the lowest inventory for top-selling products?

```sql
WITH TopProducts AS (
    SELECT TOP (10)
        o.ProductKey,
        SUM(COALESCE(o.Quantity, 0)) AS TotalUnitsSold
    FROM fact.FactOrders o
    GROUP BY o.ProductKey
    ORDER BY SUM(COALESCE(o.Quantity, 0)) DESC, o.ProductKey ASC
),
LatestInventory AS (
    SELECT
        i.ProductKey,
        i.StoreKey,
        i.SnapshotDateKey,
        COALESCE(i.QuantityOnHand, 0) AS QuantityOnHand,
        COALESCE(i.QuantityOnOrder, 0) AS QuantityOnOrder,
        ROW_NUMBER() OVER (
            PARTITION BY i.ProductKey, i.StoreKey
            ORDER BY i.SnapshotDateKey DESC, i.InventoryKey DESC
        ) AS rn
    FROM fact.FactInventory i
    JOIN TopProducts tp
        ON tp.ProductKey = i.ProductKey
)
SELECT TOP (50)
    p.ProductId,
    p.ProductName,
    p.Category,
    p.Subcategory,
    s.StoreId,
    s.StoreName,
    s.StoreType,
    s.City,
    s.State,
    s.Region,
    dd.[Date] AS SnapshotDate,
    li.QuantityOnHand,
    li.QuantityOnOrder
FROM LatestInventory li
JOIN dim.DimProduct p
    ON p.ProductKey = li.ProductKey
JOIN dim.DimStore s
    ON s.StoreKey = li.StoreKey
JOIN dim.DimDate dd
    ON dd.DateKey = li.SnapshotDateKey
WHERE li.rn = 1
ORDER BY
    li.QuantityOnHand ASC,
    li.QuantityOnOrder ASC,
    p.ProductId ASC,
    s.StoreId ASC;
```

| ProductId | ProductName | Category | Subcategory | StoreId | StoreName | StoreType | City | State | Region | SnapshotDate | QuantityOnHand | QuantityOnOrder |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| SKU-00069 | FreshHarvest Organic MC95 | Grocery | Organic | STR-004 | Stephanieshire Warehouse | Warehouse | Matthewsview | New Jersey | Northeast | 2023-04-01 | 0 | 0 |
| SKU-00144 | NorthPeak Outerwear AG10 | Clothing | Outerwear | STR-001 | New Benjaminton Warehouse | Warehouse | Turnermouth | Massachusetts | Northeast | 2025-03-01 | 2 | 0 |
| SKU-00428 | PageTurn Press Textbook KH87 | Books | Textbooks | STR-021 | Lake Brittanymouth Outlet | Outlet | Blakeside | Washington | West | 2024-11-01 | 3 | 0 |
| SKU-00428 | PageTurn Press Textbook KH87 | Books | Textbooks | STR-006 | East Johnfort Warehouse | Warehouse | West Matthew | Georgia | Southeast | 2024-03-01 | 5 | 0 |
| SKU-00458 | SoundWave Camera OT23 | Electronics | Cameras | STR-008 | Lake Lori Outlet | Outlet | North John | Virginia | Southeast | 2023-07-01 | 5 | 0 |
| SKU-00061 | PureEssence Fragrance OH07 | Beauty | Fragrance | STR-011 | West Lisa Flagship | Flagship | East Malikhaven | Ohio | Midwest | 2025-07-01 | 8 | 0 |
| SKU-00292 | SnackBox Beverage RY35 | Grocery | Beverages | STR-006 | East Johnfort Warehouse | Warehouse | West Matthew | Georgia | Southeast | 2025-10-01 | 8 | 0 |
| SKU-00418 | GlowLab Haircare HZ42 | Beauty | Haircare | STR-020 | Rasmussenfort Warehouse | Warehouse | Christopherstad | California | West | 2024-04-01 | 8 | 0 |
| SKU-00418 | GlowLab Haircare HZ42 | Beauty | Haircare | STR-017 | Larsonmouth Warehouse | Warehouse | West Jamesborough | New Mexico | Southwest | 2023-03-01 | 9 | 48 |
| SKU-00069 | FreshHarvest Organic MC95 | Grocery | Organic | STR-012 | Port Johnstad Warehouse | Warehouse | West Jenniferbury | Michigan | Midwest | 2025-12-01 | 11 | 0 |
| SKU-00292 | SnackBox Beverage RY35 | Grocery | Beverages | STR-014 | East Susan Outlet | Outlet | West Robert | Wisconsin | Midwest | 2023-03-01 | 14 | 0 |
| SKU-00458 | SoundWave Camera OT23 | Electronics | Cameras | STR-016 | Ayersmouth Outlet | Outlet | West Ericmouth | Arizona | Southwest | 2022-07-01 | 14 | 0 |
| SKU-00428 | PageTurn Press Textbook KH87 | Books | Textbooks | STR-011 | West Lisa Flagship | Flagship | East Malikhaven | Ohio | Midwest | 2024-10-01 | 18 | 13 |
| SKU-00418 | GlowLab Haircare HZ42 | Beauty | Haircare | STR-021 | Lake Brittanymouth Outlet | Outlet | Blakeside | Washington | West | 2025-02-01 | 20 | 0 |
| SKU-00318 | ChefLine Decor QW18 | Home & Kitchen | Decor | STR-006 | East Johnfort Warehouse | Warehouse | West Matthew | Georgia | Southeast | 2022-12-01 | 21 | 0 |
| SKU-00492 | Insight Books Children ZO29 | Books | Children | STR-024 | New Jeffreyfurt Flagship | Flagship | Farleyhaven | Utah | West | 2023-08-01 | 22 | 0 |
| SKU-00207 | WaveRider Cycling CU26 | Sports & Outdoors | Cycling | STR-005 | Port Victoria Outlet | Outlet | Gregfort | Florida | Southeast | 2023-01-01 | 24 | 0 |
| SKU-00458 | SoundWave Camera OT23 | Electronics | Cameras | STR-ONLINE | RetailDW Online | Online | NULL | NULL | NULL | 2024-01-01 | 26 | 0 |
| SKU-00458 | SoundWave Camera OT23 | Electronics | Cameras | STR-010 | Cynthiaton Outlet | Outlet | Edwinport | Illinois | Midwest | 2025-11-01 | 29 | 0 |
| SKU-00492 | Insight Books Children ZO29 | Books | Children | STR-009 | Port David Flagship | Flagship | Port Anthonyland | Tennessee | Southeast | 2024-07-01 | 31 | 0 |
| SKU-00458 | SoundWave Camera OT23 | Electronics | Cameras | STR-011 | West Lisa Flagship | Flagship | East Malikhaven | Ohio | Midwest | 2024-04-01 | 32 | 0 |
| SKU-00418 | GlowLab Haircare HZ42 | Beauty | Haircare | STR-007 | South Kyle Flagship | Flagship | East Kelly | North Carolina | Southeast | 2023-11-01 | 33 | 0 |
| SKU-00207 | WaveRider Cycling CU26 | Sports & Outdoors | Cycling | STR-004 | Stephanieshire Warehouse | Warehouse | Matthewsview | New Jersey | Northeast | 2024-10-01 | 35 | 0 |
| SKU-00292 | SnackBox Beverage RY35 | Grocery | Beverages | STR-013 | New Jenniferfort Outlet | Outlet | West Heathermouth | Minnesota | Midwest | 2024-08-01 | 35 | 0 |
| SKU-00318 | ChefLine Decor QW18 | Home & Kitchen | Decor | STR-015 | Lake Elizabethside Warehouse | Warehouse | Patriciachester | Texas | Southwest | 2024-10-01 | 35 | 0 |
| SKU-00492 | Insight Books Children ZO29 | Books | Children | STR-016 | Ayersmouth Outlet | Outlet | West Ericmouth | Arizona | Southwest | 2025-04-01 | 35 | 0 |
| SKU-00428 | PageTurn Press Textbook KH87 | Books | Textbooks | STR-018 | North Bradleyport Warehouse | Warehouse | Oconnorton | Oklahoma | Southwest | 2024-02-01 | 39 | 0 |
| SKU-00207 | WaveRider Cycling CU26 | Sports & Outdoors | Cycling | STR-015 | Lake Elizabethside Warehouse | Warehouse | Patriciachester | Texas | Southwest | 2024-12-01 | 41 | 0 |
| SKU-00492 | Insight Books Children ZO29 | Books | Children | STR-005 | Port Victoria Outlet | Outlet | Gregfort | Florida | Southeast | 2022-08-01 | 41 | 0 |
| SKU-00492 | Insight Books Children ZO29 | Books | Children | STR-007 | South Kyle Flagship | Flagship | East Kelly | North Carolina | Southeast | 2024-05-01 | 42 | 16 |
| SKU-00492 | Insight Books Children ZO29 | Books | Children | STR-003 | Georgeton Outlet | Outlet | Ramosstad | Connecticut | Northeast | 2025-10-01 | 46 | 0 |
| SKU-00292 | SnackBox Beverage RY35 | Grocery | Beverages | STR-002 | Gordonbury Flagship | Flagship | Louiston | Pennsylvania | Northeast | 2025-07-01 | 47 | 0 |
| SKU-00292 | SnackBox Beverage RY35 | Grocery | Beverages | STR-007 | South Kyle Flagship | Flagship | East Kelly | North Carolina | Southeast | 2025-04-01 | 47 | 0 |
| SKU-00428 | PageTurn Press Textbook KH87 | Books | Textbooks | STR-010 | Cynthiaton Outlet | Outlet | Edwinport | Illinois | Midwest | 2025-03-01 | 47 | 0 |
| SKU-00318 | ChefLine Decor QW18 | Home & Kitchen | Decor | STR-022 | Averyfort Outlet | Outlet | Port Aaron | Oregon | West | 2025-10-01 | 48 | 0 |
| SKU-00144 | NorthPeak Outerwear AG10 | Clothing | Outerwear | STR-017 | Larsonmouth Warehouse | Warehouse | West Jamesborough | New Mexico | Southwest | 2025-05-01 | 50 | 0 |
| SKU-00069 | FreshHarvest Organic MC95 | Grocery | Organic | STR-019 | New Brittneyton Flagship | Flagship | Laurenfurt | Colorado | Southwest | 2024-10-01 | 51 | 0 |
| SKU-00069 | FreshHarvest Organic MC95 | Grocery | Organic | STR-024 | New Jeffreyfurt Flagship | Flagship | Farleyhaven | Utah | West | 2023-10-01 | 51 | 0 |
| SKU-00318 | ChefLine Decor QW18 | Home & Kitchen | Decor | STR-013 | New Jenniferfort Outlet | Outlet | West Heathermouth | Minnesota | Midwest | 2023-09-01 | 53 | 19 |
| SKU-00069 | FreshHarvest Organic MC95 | Grocery | Organic | STR-016 | Ayersmouth Outlet | Outlet | West Ericmouth | Arizona | Southwest | 2025-04-01 | 56 | 0 |
| SKU-00069 | FreshHarvest Organic MC95 | Grocery | Organic | STR-007 | South Kyle Flagship | Flagship | East Kelly | North Carolina | Southeast | 2025-12-01 | 57 | 0 |
| SKU-00207 | WaveRider Cycling CU26 | Sports & Outdoors | Cycling | STR-014 | East Susan Outlet | Outlet | West Robert | Wisconsin | Midwest | 2025-11-01 | 63 | 0 |
| SKU-00428 | PageTurn Press Textbook KH87 | Books | Textbooks | STR-003 | Georgeton Outlet | Outlet | Ramosstad | Connecticut | Northeast | 2023-09-01 | 64 | 0 |
| SKU-00207 | WaveRider Cycling CU26 | Sports & Outdoors | Cycling | STR-022 | Averyfort Outlet | Outlet | Port Aaron | Oregon | West | 2025-07-01 | 65 | 0 |
| SKU-00061 | PureEssence Fragrance OH07 | Beauty | Fragrance | STR-024 | New Jeffreyfurt Flagship | Flagship | Farleyhaven | Utah | West | 2024-07-01 | 67 | 0 |
| SKU-00207 | WaveRider Cycling CU26 | Sports & Outdoors | Cycling | STR-002 | Gordonbury Flagship | Flagship | Louiston | Pennsylvania | Northeast | 2025-01-01 | 69 | 0 |
| SKU-00292 | SnackBox Beverage RY35 | Grocery | Beverages | STR-009 | Port David Flagship | Flagship | Port Anthonyland | Tennessee | Southeast | 2023-04-01 | 71 | 0 |
| SKU-00418 | GlowLab Haircare HZ42 | Beauty | Haircare | STR-ONLINE | RetailDW Online | Online | NULL | NULL | NULL | 2023-04-01 | 72 | 29 |
| SKU-00069 | FreshHarvest Organic MC95 | Grocery | Organic | STR-018 | North Bradleyport Warehouse | Warehouse | Oconnorton | Oklahoma | Southwest | 2022-12-01 | 75 | 0 |
| SKU-00144 | NorthPeak Outerwear AG10 | Clothing | Outerwear | STR-024 | New Jeffreyfurt Flagship | Flagship | Farleyhaven | Utah | West | 2023-09-01 | 75 | 23 |

*50 rows*
